"use strict";exports.id=7158,exports.ids=[7158],exports.modules={40389:(e,t,a)=>{a.r(t),a.d(t,{InvitationTemplateForm:()=>_,default:()=>P});var s=a(54714),r=a(77580),n=a(96379),i=a(19863),l=a(52570),o=a(53278),c=a(43521),d=a(11671),u=a(90869),m=a(21124),f=a(29872),p=a(57801);a(28892);var h=a(15537),x=(0,h.$)("b0f99d0142a5d8e475d580c755909090e3fe1119");(0,h.$)("3fbacc693036abe246b01efb3ca2dbf7692aa06d");var g=(0,h.$)("941498169eda49bf447057e2930d38404473986d");(0,h.$)("39af9c8a150fea3c92c70413f968e670749439e6"),(0,h.$)("5f6846a1a963af1164135037ef6443813c293529");var b=a(17694),y=a(16789),v=a(51500);function j({value:e,onChange:t,label:a="Image",error:n}){let[i,l]=(0,r.useState)(e?"string"==typeof e?(0,v.j)(e):URL.createObjectURL(e):null),o=(0,r.useRef)(null);return(0,s.jsxs)("div",{className:"space-y-2",children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700",children:a}),(0,s.jsxs)("div",{className:`border-2 border-dashed rounded-xl p-4 transition-colors ${n?"border-red-300 bg-red-50":"border-slate-300 hover:border-neon-blue bg-slate-50"}`,children:[i?(0,s.jsxs)("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-white shadow-sm group",children:[s.jsx("img",{src:i,alt:"Preview",className:"w-full h-full object-cover"}),s.jsx("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:s.jsx("button",{type:"button",onClick:()=>{l(null),o.current&&(o.current.value=""),t(null)},className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:s.jsx(b.Z,{size:20})})})]}):(0,s.jsxs)("div",{onClick:()=>o.current?.click(),className:"flex flex-col items-center justify-center gap-2 py-8 cursor-pointer hover:text-neon-blue text-slate-400 transition-colors",children:[s.jsx(y.Z,{size:32}),s.jsx("span",{className:"text-sm font-medium",children:"Click to upload image"}),s.jsx("span",{className:"text-xs text-slate-400",children:"JPG, PNG, WEBP up to 5MB"})]}),s.jsx("input",{ref:o,type:"file",accept:"image/*",onChange:e=>{let a=e.target.files?.[0];a&&(l(URL.createObjectURL(a)),t(a))},className:"hidden"})]}),n&&s.jsx("p",{className:"text-sm text-red-500",children:n})]})}async function w(e){return!e.type.startsWith("image/")||e.size<512e3?e:Promise.race([new Promise((t,a)=>{let s=new FileReader;s.readAsDataURL(e),s.onload=s=>{let r=new Image;r.src=s.target?.result,r.onload=()=>{let a=document.createElement("canvas"),s=r.width,n=r.height;s>n?s>1920&&(n*=1920/s,s=1920):n>1920&&(s*=1920/n,n=1920),a.width=s,a.height=n;let i=a.getContext("2d");if(!i){t(e);return}i.drawImage(r,0,0,s,n),a.toBlob(a=>{if(!a){t(e);return}t(new File([a],e.name.replace(/\.[^/.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()}))},"image/jpeg",.8)},r.onerror=e=>a(e)},s.onerror=e=>a(e)}),new Promise(t=>{setTimeout(()=>{console.warn("Image compression timed out, using original"),t(e)},1e4)})])}var k=a(67600);let N=l.Ryn({name:l.Z_8().min(1,"Name is required"),background_image:l.G0j([l.PpW(File),l.Z_8()]).refine(e=>null!==e&&""!==e,"Background image is required"),default_title:l.Z_8().min(1,"Default Title is required"),default_message:l.Z_8().min(1,"Default Message is required"),is_active:l.O72()});function _({initialId:e}){let t=(0,p.useRouter)(),[a,l]=(0,r.useState)(!1),[h,b]=(0,r.useState)(!!e),[y,v]=(0,r.useState)(""),{showToast:_}=(0,k.useToast)(),[P,$]=(0,r.useState)(!1),S=(0,n.cI)({resolver:(0,i.F)(N),defaultValues:{name:"",background_image:"",default_title:"You're Invited!",default_message:"Come join us for a party at Ninja Inflatable Park!",is_active:!0}});(0,r.useEffect)(()=>{e&&T(e)},[e]);let T=async e=>{try{let t=await g(e);t&&S.reset({name:t.name,background_image:t.background_image,default_title:t.default_title,default_message:t.default_message,is_active:t.is_active})}catch(e){console.error(e),v("Failed to load template")}finally{b(!1)}},Z=async a=>{l(!0),v(""),$(!1);try{let s=new FormData;if(s.append("name",a.name),s.append("default_title",a.default_title),s.append("default_message",a.default_message),s.append("is_active",a.is_active?"true":"false"),a.background_image instanceof File)try{let e=await w(a.background_image);s.append("background_image",e)}catch(e){if(console.error("Compression failed, using original",e),a.background_image.size>10485760)throw Error("Image is too large and compression failed. Please upload a smaller image.");s.append("background_image",a.background_image)}let r="http://localhost:8000/api/v1",n=e?`${r}/invitations/templates/${e}/`:`${r}/invitations/templates/`,i=e?"PATCH":"POST",l=function(e){let t=`; ${document.cookie}`.split(`; ${e}=`);return 2===t.length&&t.pop()?.split(";").shift()||""}("csrftoken"),o=await fetch(n,{method:i,body:s,credentials:"include",headers:{"X-CSRFToken":l}});if(!o.ok){let t=await o.json().catch(()=>({detail:"Request failed"}));throw Error(t.detail||`Failed to ${e?"update":"create"} template`)}_("success",`Template ${e?"updated":"created"} successfully!`),$(!0),setTimeout(()=>{t.push("/admin/invitations"),t.refresh()},1e3)}catch(t){console.error("Submission error:",t);let e=t.message||"Something went wrong";v(e),_("error",e)}finally{l(!1)}},A=async()=>{if(e&&confirm("Are you sure you want to delete this template?")){l(!0);try{await x(e),t.push("/admin/invitations"),t.refresh()}catch(e){v(e.message||"Failed to delete"),l(!1)}}};return h?s.jsx("div",{className:"p-8 text-center text-slate-500",children:"Loading template..."}):(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[s.jsx(f.default,{href:"/admin/invitations",className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:s.jsx(o.Z,{className:"w-5 h-5 text-slate-500"})}),s.jsx("h1",{className:"text-2xl font-bold text-slate-900",children:e?"Edit Template":"New Template"})]}),(0,s.jsxs)("form",{onSubmit:S.handleSubmit(Z),className:"space-y-6 bg-white p-6 rounded-xl border border-slate-200 shadow-sm",children:[y&&s.jsx("div",{className:"p-4 bg-red-50 text-red-600 rounded-lg text-sm",children:y}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Template Name"}),s.jsx("input",{...S.register("name"),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-blue/20 focus:border-neon-blue text-slate-900",placeholder:"e.g. Superhero Theme"}),S.formState.errors.name&&s.jsx("p",{className:"text-xs text-red-500 mt-1",children:S.formState.errors.name.message})]}),(0,s.jsxs)("div",{children:[s.jsx(n.Qr,{control:S.control,name:"background_image",render:({field:{value:e,onChange:t}})=>s.jsx(j,{label:"Background Image",value:e,onChange:t,error:S.formState.errors.background_image?.message})}),s.jsx("p",{className:"text-xs text-slate-500 mt-1",children:"Recommended size: 1920x1080px or similar landscape."})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Default Title"}),s.jsx("input",{...S.register("default_title"),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-blue/20 focus:border-neon-blue text-slate-900",placeholder:"You're Invited!"})]}),(0,s.jsxs)("div",{children:[s.jsx("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Default Message"}),s.jsx("textarea",{...S.register("default_message"),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-blue/20 focus:border-neon-blue text-slate-900 min-h-[100px]",placeholder:"Come celebrate..."})]}),s.jsx("div",{className:"flex items-center pt-2",children:(0,s.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[s.jsx("input",{type:"checkbox",...S.register("is_active"),className:"w-4 h-4 rounded border-slate-300 text-neon-blue focus:ring-neon-blue"}),s.jsx("span",{className:"text-sm font-medium text-slate-700",children:"Active (Visible to customers)"})]})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-slate-100",children:[e&&(0,s.jsxs)("button",{type:"button",onClick:A,disabled:a,className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm font-medium",children:[s.jsx(c.Z,{className:"w-4 h-4"}),"Delete"]}),(0,s.jsxs)("button",{type:"submit",disabled:a||P,className:`flex items-center gap-2 px-6 py-2 rounded-lg transition-all text-sm font-bold disabled:opacity-50 ${P?"bg-green-500 text-white hover:bg-green-600":"bg-neon-blue text-white hover:bg-blue-600"}`,children:[a?s.jsx(d.Z,{className:"w-4 h-4 animate-spin"}):P?s.jsx(u.Z,{className:"w-4 h-4"}):s.jsx(m.Z,{className:"w-4 h-4"}),P?"Saved!":e?"Update Template":"Create Template"]})]})]})]})}let P=_},51500:(e,t,a)=>{a.d(t,{j:()=>s});let s=e=>{if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;if(e.startsWith("uploads/")||e.startsWith("media/")||e.startsWith("logos/")){let t=e.startsWith("/")?e.substring(1):e;return`https://ninjapark.blob.core.windows.net/media/${t}`}let t="http://localhost:8000/api/v1".replace("/api/v1","");return e.startsWith("/")?`${t}${e}`:`${t}/${e}`}},53278:(e,t,a)=>{a.d(t,{Z:()=>s});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(59858).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},21124:(e,t,a)=>{a.d(t,{Z:()=>s});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(59858).Z)("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]])},43521:(e,t,a)=>{a.d(t,{Z:()=>s});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(59858).Z)("Trash",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]])},16789:(e,t,a)=>{a.d(t,{Z:()=>s});/**
 * @license lucide-react v0.300.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=(0,a(59858).Z)("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]])},88437:(e,t,a)=>{a.r(t),a.d(t,{getNotifications:()=>i,getUnreadCount:()=>o,getUnreadNotifications:()=>l,markAllAsRead:()=>d,markAsRead:()=>c});var s=a(21354);a(27277);var r=a(99592),n=a(35643);async function i(){try{let e=await (0,r.fetchAPI)("/core/notifications/");if(!e||!e.ok)return[];return await e.json()}catch(e){return console.error("Error fetching notifications:",e),[]}}async function l(){try{let e=await (0,r.fetchAPI)("/core/notifications/unread/");if(!e||!e.ok)return[];return await e.json()}catch(e){return console.error("Error fetching unread notifications:",e),[]}}async function o(){try{let e=await (0,r.fetchAPI)("/core/notifications/unread_count/");if(!e||!e.ok)return 0;return(await e.json()).count||0}catch(e){return console.error("Error fetching unread count:",e),0}}async function c(e){try{let t=await (0,r.fetchAPI)(`/core/notifications/${e}/mark_read/`,{method:"POST"});if(t&&t.ok)return(0,n.revalidatePath)("/admin"),{success:!0};return{success:!1}}catch(e){return console.error("Error marking notification as read:",e),{success:!1}}}async function d(){try{let e=await (0,r.fetchAPI)("/core/notifications/mark_all_read/",{method:"POST"});if(e&&e.ok)return(0,n.revalidatePath)("/admin"),{success:!0};return{success:!1}}catch(e){return console.error("Error marking all notifications as read:",e),{success:!1}}}(0,a(60663).ensureServerEntryExports)([i,l,o,c,d]),(0,s.createActionProxy)("cfbda83e87c5e4a47b3822d9ff670c9cccf1ebf4",i),(0,s.createActionProxy)("4b8a1f5b022fcc68cce8c3f8eec3ff8e9415b47b",l),(0,s.createActionProxy)("3c1d7275620e15e401cb797bfd91bddf6a7fa8ec",o),(0,s.createActionProxy)("85c2a0f83f54dd422e82eea5939d5a9c7782fff0",c),(0,s.createActionProxy)("25e8c8a61a9353863cf40a090ceb5f00692fc1a0",d)}};