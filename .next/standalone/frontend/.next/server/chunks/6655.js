"use strict";exports.id=6655,exports.ids=[6655],exports.modules={96655:(e,t,a)=>{a.r(t),a.d(t,{createBookingBlock:()=>L,deleteBooking:()=>x,deleteBookingBlock:()=>W,deletePartyBooking:()=>_,getAllBookings:()=>h,getBookingBlocks:()=>U,getBookingById:()=>I,getBookings:()=>p,getCustomerById:()=>O,getCustomers:()=>D,getDashboardStats:()=>y,getPartyBookingById:()=>P,getPartyBookingHistory:()=>M,getPartyBookings:()=>m,getSessionBookingHistory:()=>H,getSessionBookings:()=>S,getWaiverById:()=>R,getWaivers:()=>C,loginAdmin:()=>k,logoutAdmin:()=>f,resendPartyBookingEmail:()=>w,restorePartyBooking:()=>V,restoreSessionBooking:()=>G,toggleBookingArrival:()=>F,toggleWaiverVerification:()=>E,updateBooking:()=>d,updateBookingBlock:()=>J,updateBookingDetails:()=>B,updateBookingStatus:()=>$,updateCustomerDetails:()=>j,updatePartyBooking:()=>v,updatePartyBookingStatus:()=>A,updateWaiverMinors:()=>N,verifyWaiver:()=>T});var o=a(21354);a(27277);var r=a(84357),n=a(35643),i=a(36866),s=a(99592),c=a(60663);async function d(e,t){try{let a=await (0,s.fetchAPI)(`/bookings/bookings/${e}/`,{method:"PATCH",body:JSON.stringify(t)});if(!a||!a.ok){let e=await a.json().catch(()=>({}));return{success:!1,error:e.detail||"Failed to update booking"}}return(0,n.revalidatePath)("/admin/bookings"),(0,n.revalidatePath)(`/admin/bookings/${e}`),{success:!0}}catch(e){return console.error("Update booking error:",e),{success:!1,error:"Failed to connect to server"}}}function g(e){if(!e)return null;let t=e.customer_details?u(e.customer_details):null;return{...e,bookingStatus:e.booking_status||e.status,waiverStatus:e.waiver_status,paymentStatus:e.payment_status,createdAt:e.created_at,updatedAt:e.updated_at,voucherCode:e.voucher_code,discountAmount:e.discount_amount,packageName:e.package_name,birthdayChildName:e.birthday_child_name,birthdayChildAge:e.birthday_child_age,waiverSigned:e.waiver_signed,waiverSignedAt:e.waiver_signed_at,waiverIpAddress:e.waiver_ip_address,customerName:e.name||t?.name||null,customerEmail:t?.email||e.email||null,customerPhone:t?.phone||e.phone||null,customer:t,waivers:e.waivers?.map(l)||[],transactions:e.transactions||[],duration:e.duration||120,spectators:e.spectators||0}}function u(e){return e?{...e,createdAt:e.created_at,updatedAt:e.updated_at,_count:e._count||{bookings:0}}:null}function l(e){return e?{...e,signedAt:e.signed_at,fileUrl:e.file_url,emergencyContact:e.emergency_contact,minors:e.minors||[],adults:e.adults||[],isPrimarySigner:e.is_primary_signer,participantType:e.participant_type,isVerified:e.is_verified,booking:e.booking_details?g(e.booking_details):null}:null}function b(e){return e?{...e,startDate:e.start_date,endDate:e.end_date,createdAt:e.created_at,updatedAt:e.updated_at}:null}async function k(e){let t=e.get("email"),a=e.get("password");if(!t||!a)return{error:"Email and password are required"};let o="http://127.0.0.1:8000/api/token/";console.log("[Login Debug] Force Target URL:",o);try{let e=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,username:t,password:a}),cache:"no-store"});if(!e.ok){let t=await e.text();return console.error("[Login Debug] Failed response:",e.status,t),{error:`Login failed: ${e.status} ${e.statusText}`}}let n=(await e.json()).access;(0,r.cookies)().set("admin_token",n,{httpOnly:!0,secure:!0,maxAge:604800,path:"/",sameSite:"lax"}),console.log("[Login Debug] Cookie set successfully, redirecting to /admin")}catch(e){return console.error("Login error:",e),{error:`Connection error: ${e.message}`}}(0,i.redirect)("/admin")}async function f(){(0,r.cookies)().delete("admin_token"),(0,i.redirect)("/admin/login")}async function y(){let e=await (0,s.fetchAPI)("/core/dashboard/stats/");if(!e||!e.ok)throw Error("Unauthorized or Failed to fetch stats");return await e.json()}async function h(e){try{let t=new URLSearchParams;e?.type&&t.append("type",e.type),e?.status&&t.append("status",e.status),e?.search&&t.append("search",e.search);let a=await (0,s.fetchAPI)(`/core/dashboard/all_bookings/?${t.toString()}`);if(!a||!a.ok)return console.error("Failed to fetch bookings:",a?.status,a?.statusText),[];return(await a.json()).results||[]}catch(e){return console.error("Error fetching all bookings:",e),[]}}async function p(e){let t=new URLSearchParams;t.append("ordering","-created_at"),e?.status&&t.append("booking_status",e.status),e?.date&&t.append("date",e.date),e?.search&&t.append("search",e.search);let a=await (0,s.fetchAPI)(`/bookings/bookings/?${t.toString()}`);return a&&a.ok?(await a.json()).map(g):[]}async function m(e){let t=new URLSearchParams;t.append("ordering","-created_at"),e?.status&&t.append("status",e.status),e?.date&&t.append("date",e.date),e?.search&&t.append("search",e.search);let a=await (0,s.fetchAPI)(`/bookings/party-bookings/?${t.toString()}`);return a&&a.ok?(await a.json()).map(g):[]}async function P(e){let t=await (0,s.fetchAPI)(`/bookings/party-bookings/${e}/`);return t&&t.ok?g(await t.json()):null}async function A(e,t){let a=await (0,s.fetchAPI)(`/bookings/party-bookings/${e}/`,{method:"PATCH",body:JSON.stringify({booking_status:t})});a&&a.ok&&((0,n.revalidatePath)("/admin/party-bookings"),(0,n.revalidatePath)(`/admin/party-bookings/${e}`))}async function _(e){let t=await (0,s.fetchAPI)(`/bookings/party-bookings/${e}/`,{method:"DELETE"});return t&&t.ok&&(0,n.revalidatePath)("/admin/party-bookings"),t?.ok}async function w(e){let t=await (0,s.fetchAPI)(`/bookings/party-bookings/${e}/resend_confirmation_email/`,{method:"POST"});return t&&t.ok?{success:!0,message:(await t.json()).message}:{success:!1,message:"Failed to send email"}}async function v(e,t){let a=await (0,s.fetchAPI)(`/bookings/party-bookings/${e}/`,{method:"PATCH",body:JSON.stringify(t)});return a&&a.ok?((0,n.revalidatePath)("/admin/party-bookings"),(0,n.revalidatePath)(`/admin/party-bookings/${e}`),{success:!0}):{success:!1,error:(await a?.json().catch(()=>({}))).detail||"Failed to update booking"}}async function S(e){let t=new URLSearchParams;t.append("type","SESSION"),t.append("ordering","-created_at"),e?.status&&t.append("status",e.status),e?.date&&t.append("date",e.date),e?.search&&t.append("search",e.search),console.log("[DEBUG] getSessionBookings - Request URL:",`/bookings/bookings/?${t.toString()}`);let a=await (0,s.fetchAPI)(`/bookings/bookings/?${t.toString()}`);if(console.log("[DEBUG] getSessionBookings - Response status:",a?.status),console.log("[DEBUG] getSessionBookings - Response ok:",a?.ok),!a||!a.ok)return console.log("[DEBUG] getSessionBookings - Response not OK, returning empty array"),[];let o=await a.json();return console.log("[DEBUG] getSessionBookings - Response data:",o),console.log("[DEBUG] getSessionBookings - Data length:",o?.length),o.map(g)}async function $(e,t){let a=await (0,s.fetchAPI)(`/bookings/bookings/${e}/`,{method:"PATCH",body:JSON.stringify({booking_status:t})});a&&a.ok&&((0,n.revalidatePath)("/admin/bookings"),(0,n.revalidatePath)(`/admin/bookings/${e}`))}async function x(e){let t=await (0,s.fetchAPI)(`/bookings/bookings/${e}/`,{method:"DELETE"});return t&&t.ok&&(0,n.revalidatePath)("/admin/bookings"),t?.ok}async function B(e,t){let a=await (0,s.fetchAPI)(`/bookings/bookings/${e}/`,{method:"PATCH",body:JSON.stringify(t)});a&&a.ok&&((0,n.revalidatePath)("/admin/bookings"),(0,n.revalidatePath)(`/admin/bookings/${e}`))}async function I(e){let t=await (0,s.fetchAPI)(`/bookings/bookings/${e}/`);return t&&t.ok?g(await t.json()):null}async function T(e){let t=await (0,s.fetchAPI)(`/bookings/waivers/${e}/`,{method:"PATCH",body:JSON.stringify({is_verified:!0})});return t&&t.ok?((0,n.revalidatePath)("/admin/waivers"),{success:!0}):{success:!1}}async function E(e,t){let a=await (0,s.fetchAPI)(`/bookings/waivers/${e}/`,{method:"PATCH",body:JSON.stringify({is_verified:t})});if(a&&a.ok)return(0,n.revalidatePath)("/admin/waivers"),{success:!0};let o="Failed to update status";if(a){let e=await a.text();console.error(`toggleWaiverVerification failed: ${a.status} ${a.statusText}`,e),o=`Error: ${a.status} ${a.statusText}`}else console.error("toggleWaiverVerification failed: No response");return{success:!1,error:o}}async function N(e,t){let a={minors:t};console.log("updateWaiverMinors - Sending payload:",JSON.stringify(a,null,2)),console.log("updateWaiverMinors - Endpoint:",`/bookings/waivers/${e}/`);let o=await (0,s.fetchAPI)(`/bookings/waivers/${e}/`,{method:"PATCH",body:JSON.stringify(a)});if(console.log("updateWaiverMinors - Response status:",o?.status),console.log("updateWaiverMinors - Response ok:",o?.ok),o&&o.ok)return(0,n.revalidatePath)("/admin/waivers"),(0,n.revalidatePath)(`/admin/waivers/${e}`),{success:!0};let r="Failed to update minors";if(o)try{let e=await o.json();console.error(`updateWaiverMinors failed: ${o.status} ${o.statusText}`,e),r=e.minors?e.minors[0]:e.detail||`Error: ${o.status} ${o.statusText}`}catch(t){let e=await o.text();console.error(`updateWaiverMinors failed: ${o.status} ${o.statusText}`,e),r=`Error: ${o.status} ${o.statusText}`}return{success:!1,error:r}}async function C(e){let t=new URLSearchParams;e&&t.append("search",e);let a=await (0,s.fetchAPI)(`/bookings/waivers/?${t.toString()}`);return a&&a.ok?(await a.json()).map(l):[]}async function j(e,t){let a=await (0,s.fetchAPI)(`/bookings/customers/${e}/`,{method:"PATCH",body:JSON.stringify(t)});a&&a.ok&&(0,n.revalidatePath)("/admin/customers")}async function D(e){let t=new URLSearchParams;e&&t.append("search",e);let a=await (0,s.fetchAPI)(`/bookings/customers/?${t.toString()}`);return a&&a.ok?(await a.json()).map(u):[]}async function O(e){let t=await (0,s.fetchAPI)(`/bookings/customers/${e}/`);return t&&t.ok?u(await t.json()):null}async function R(e){let t=await (0,s.fetchAPI)(`/bookings/waivers/${e}/`);return t&&t.ok?l(await t.json()):null}async function U(){let e=await (0,s.fetchAPI)("/bookings/booking-blocks/");return e&&e.ok?(await e.json()).map(b):[]}async function L(e){let t={start_date:e.startDate,end_date:e.endDate,reason:e.reason,type:e.type,recurring:e.recurring},a=await (0,s.fetchAPI)("/bookings/booking-blocks/",{method:"POST",body:JSON.stringify(t)});a&&a.ok&&(0,n.revalidatePath)("/admin/booking-blocks")}async function J(e,t){let a={start_date:t.startDate,end_date:t.endDate,reason:t.reason,type:t.type,recurring:t.recurring},o=await (0,s.fetchAPI)(`/bookings/booking-blocks/${e}/`,{method:"PATCH",body:JSON.stringify(a)});o&&o.ok&&(0,n.revalidatePath)("/admin/booking-blocks")}async function W(e){let t=await (0,s.fetchAPI)(`/bookings/booking-blocks/${e}/`,{method:"DELETE"});t&&t.ok&&(0,n.revalidatePath)("/admin/booking-blocks")}async function F(e,t,a){let o="session"===t?`/bookings/bookings/${e}/${a?"mark_arrived":"mark_not_arrived"}/`:`/bookings/party-bookings/${e}/${a?"mark_arrived":"mark_not_arrived"}/`;try{let a=await (0,s.fetchAPI)(o,{method:"POST"});if(a&&a.ok)return(0,n.revalidatePath)("/admin/bookings"),(0,n.revalidatePath)("/admin/party-bookings"),(0,n.revalidatePath)(`/admin/${t}-bookings/${e}`),{success:!0};return{success:!1,error:"API request failed"}}catch(e){return console.error("Error toggling arrival:",e),{success:!1,error:String(e)}}}async function H(){let e=await (0,s.fetchAPI)("/bookings/session-booking-history/");return e&&e.ok?(await e.json()).map(e=>({...e,canRestore:e.can_restore,restoredAt:e.restored_at,restoredBy:e.restored_by,restoredByName:e.restored_by_name,restoredBookingId:e.restored_booking_id,originalBookingId:e.original_booking_id,paymentTransactionId:e.payment_transaction_id,paymentAmount:e.payment_amount,failureReason:e.failure_reason,createdAt:e.created_at,updatedAt:e.updated_at,voucherCode:e.voucher_code,discountAmount:e.discount_amount})):[]}async function M(){let e=await (0,s.fetchAPI)("/bookings/party-booking-history/");return e&&e.ok?(await e.json()).map(e=>({...e,canRestore:e.can_restore,restoredAt:e.restored_at,restoredBy:e.restored_by,restoredByName:e.restored_by_name,restoredBookingId:e.restored_booking_id,originalBookingId:e.original_booking_id,paymentTransactionId:e.payment_transaction_id,paymentAmount:e.payment_amount,failureReason:e.failure_reason,packageName:e.package_name,birthdayChildName:e.birthday_child_name,birthdayChildAge:e.birthday_child_age,createdAt:e.created_at,updatedAt:e.updated_at})):[]}async function G(e){let t=await (0,s.fetchAPI)(`/bookings/session-booking-history/${e}/restore/`,{method:"POST"});if(!t)return{success:!1,error:"Network error"};let a=await t.json();return t.ok?((0,n.revalidatePath)("/admin/session-bookings/history"),(0,n.revalidatePath)("/admin/bookings"),(0,n.revalidatePath)("/admin/all-bookings"),{success:!0,bookingId:a.booking_id,message:a.message}):{success:!1,error:a.error||"Failed to restore booking"}}async function V(e){let t=await (0,s.fetchAPI)(`/bookings/party-booking-history/${e}/restore/`,{method:"POST"});if(!t)return{success:!1,error:"Network error"};let a=await t.json();return t.ok?((0,n.revalidatePath)("/admin/party-bookings/history"),(0,n.revalidatePath)("/admin/party-bookings"),(0,n.revalidatePath)("/admin/all-bookings"),{success:!0,bookingId:a.booking_id,message:a.message}):{success:!1,error:a.error||"Failed to restore party booking"}}process.env.API_URL,(0,c.ensureServerEntryExports)([d,k,f,y,h,p,m,P,A,_,w,v,S,$,x,B,I,T,E,N,C,j,D,O,R,U,L,J,W,F,H,M,G,V]),(0,o.createActionProxy)("72bf0c3115ace700fdbe92609e40ef727f6e2e9a",d),(0,o.createActionProxy)("781eabc081078ba07c5dca2961dfd5174f61ad5c",k),(0,o.createActionProxy)("e46e056505ba9c21e65755fe78e4d9e136f86362",f),(0,o.createActionProxy)("6121403de3ce7671509162f28a52f7b4eaeff528",y),(0,o.createActionProxy)("d92b4b48651b0207f49bc42ae575077cdec3e411",h),(0,o.createActionProxy)("22a10893c5718c944fe761dd831251f93e6775b9",p),(0,o.createActionProxy)("b8bf2dc29fa3626f10e6027121c5728fbfc0abd6",m),(0,o.createActionProxy)("c85fddc17f48c7e5e41cfa5391d110e4e65cbe50",P),(0,o.createActionProxy)("53044355be2ec2dc177c7e7b8b16323e311f0326",A),(0,o.createActionProxy)("2c1b655d510f2e8986beb1470bcf39e720b610dc",_),(0,o.createActionProxy)("2788aa0878a99d77f68402e20b59c6532ded18d2",w),(0,o.createActionProxy)("7d8a09a290318f0dfb4c32d4ead6e3b2326b11ce",v),(0,o.createActionProxy)("c80f1a1c040ba7c09b4c27c71fb39116e2823b2a",S),(0,o.createActionProxy)("93d6bd79e2305e9fa4e391db0cd1ffb488369a1d",$),(0,o.createActionProxy)("8d547064179501ce1ea4649e478fbf49e6473b19",x),(0,o.createActionProxy)("e426f40152b2e033cca9effa52511ce12b949d52",B),(0,o.createActionProxy)("37874dfd2fc4b6f0ee28c02a735d876d4ab315a3",I),(0,o.createActionProxy)("d5f1ecc7b99ddd36607b07794a41de699d232d70",T),(0,o.createActionProxy)("c00f3eee56aa6d980d28786a353ddb302062907e",E),(0,o.createActionProxy)("95a1b74108874a48ee8788e023fb227f64dbda91",N),(0,o.createActionProxy)("71442caae190626eedb233beee8e6e8c9c396109",C),(0,o.createActionProxy)("1fd1315d0d4a637cca24d5b73b78ca7b795fce82",j),(0,o.createActionProxy)("49bd40b69d563dfe5ff617908e276df71ebdbc54",D),(0,o.createActionProxy)("345a0d40e1b94dbe0fc6f20521428d743ae8e74b",O),(0,o.createActionProxy)("5d158ae087a84dea77f3a7115cc49824ff3c841b",R),(0,o.createActionProxy)("9cf94cfdb457087ba9f825e010e297fa11b3c2c8",U),(0,o.createActionProxy)("5391122b95e0d787d35c0b389b61ae3052c8ce42",L),(0,o.createActionProxy)("e57dc804520282bb2373ffdcde17e74d9b9c1c84",J),(0,o.createActionProxy)("91669db3d44938b80c2051708c62dd895de08312",W),(0,o.createActionProxy)("92eec72f6cda029d68ffc5f7747cf878f62592f6",F),(0,o.createActionProxy)("bbfa2f626c0ce2d9495a71bb6fbdd62c712f6d1d",H),(0,o.createActionProxy)("d0fb7859064b83124c23362f1eaba7c07d92a01a",M),(0,o.createActionProxy)("b065149b1f592078e3633999bfc44b4507d24cd2",G),(0,o.createActionProxy)("022d8cab0ebd51fd7c8a2bab806d3d4081ce9d79",V)}};