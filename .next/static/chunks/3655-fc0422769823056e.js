"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3655],{43655:function(e,t,a){a.r(t),a.d(t,{InvitationTemplateForm:function(){return _},default:function(){return C}});var s=a(20984),r=a(30208),l=a(20142),n=a(81266),i=a(86149),o=a(94601),c=a(45987),d=a(81558),u=a(58518),m=a(23913),x=a(40346),f=a(46665);a(54465);var p=a(77537),h=(0,p.$)("b0f99d0142a5d8e475d580c755909090e3fe1119");(0,p.$)("3fbacc693036abe246b01efb3ca2dbf7692aa06d");var g=(0,p.$)("941498169eda49bf447057e2930d38404473986d");(0,p.$)("39af9c8a150fea3c92c70413f968e670749439e6"),(0,p.$)("5f6846a1a963af1164135037ef6443813c293529");var b=a(45747),v=a(54148),j=a(21066);function w(e){let{value:t,onChange:a,label:l="Image",error:n}=e,[i,o]=(0,r.useState)(t?"string"==typeof t?(0,j.j)(t):URL.createObjectURL(t):null),c=(0,r.useRef)(null);return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700",children:l}),(0,s.jsxs)("div",{className:"border-2 border-dashed rounded-xl p-4 transition-colors ".concat(n?"border-red-300 bg-red-50":"border-slate-300 hover:border-neon-blue bg-slate-50"),children:[i?(0,s.jsxs)("div",{className:"relative aspect-video rounded-lg overflow-hidden bg-white shadow-sm group",children:[(0,s.jsx)("img",{src:i,alt:"Preview",className:"w-full h-full object-cover"}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:(0,s.jsx)("button",{type:"button",onClick:()=>{o(null),c.current&&(c.current.value=""),a(null)},className:"p-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:(0,s.jsx)(b.Z,{size:20})})})]}):(0,s.jsxs)("div",{onClick:()=>{var e;return null===(e=c.current)||void 0===e?void 0:e.click()},className:"flex flex-col items-center justify-center gap-2 py-8 cursor-pointer hover:text-neon-blue text-slate-400 transition-colors",children:[(0,s.jsx)(v.Z,{size:32}),(0,s.jsx)("span",{className:"text-sm font-medium",children:"Click to upload image"}),(0,s.jsx)("span",{className:"text-xs text-slate-400",children:"JPG, PNG, WEBP up to 5MB"})]}),(0,s.jsx)("input",{ref:c,type:"file",accept:"image/*",onChange:e=>{var t;let s=null===(t=e.target.files)||void 0===t?void 0:t[0];s&&(o(URL.createObjectURL(s)),a(s))},className:"hidden"})]}),n&&(0,s.jsx)("p",{className:"text-sm text-red-500",children:n})]})}async function N(e){return!e.type.startsWith("image/")||e.size<512e3?e:Promise.race([new Promise((t,a)=>{let s=new FileReader;s.readAsDataURL(e),s.onload=s=>{var r;let l=new Image;l.src=null===(r=s.target)||void 0===r?void 0:r.result,l.onload=()=>{let a=document.createElement("canvas"),s=l.width,r=l.height;s>r?s>1920&&(r*=1920/s,s=1920):r>1920&&(s*=1920/r,r=1920),a.width=s,a.height=r;let n=a.getContext("2d");if(!n){t(e);return}n.drawImage(l,0,0,s,r),a.toBlob(a=>{if(!a){t(e);return}t(new File([a],e.name.replace(/\.[^/.]+$/,".jpg"),{type:"image/jpeg",lastModified:Date.now()}))},"image/jpeg",.8)},l.onerror=e=>a(e)},s.onerror=e=>a(e)}),new Promise(t=>{setTimeout(()=>{console.warn("Image compression timed out, using original"),t(e)},1e4)})])}var y=a(24137);let k=i.Ryn({name:i.Z_8().min(1,"Name is required"),background_image:i.G0j([i.PpW(File),i.Z_8()]).refine(e=>null!==e&&""!==e,"Background image is required"),default_title:i.Z_8().min(1,"Default Title is required"),default_message:i.Z_8().min(1,"Default Message is required"),is_active:i.O72()});function _(e){let{initialId:t}=e,a=(0,f.useRouter)(),[i,p]=(0,r.useState)(!1),[b,v]=(0,r.useState)(!!t),[j,_]=(0,r.useState)(""),{showToast:C}=(0,y.useToast)(),[T,S]=(0,r.useState)(!1),Z=(0,l.cI)({resolver:(0,n.F)(k),defaultValues:{name:"",background_image:"",default_title:"You're Invited!",default_message:"Come join us for a party at Ninja Inflatable Park!",is_active:!0}});(0,r.useEffect)(()=>{t&&P(t)},[t]);let P=async e=>{try{let t=await g(e);t&&Z.reset({name:t.name,background_image:t.background_image,default_title:t.default_title,default_message:t.default_message,is_active:t.is_active})}catch(e){console.error(e),_("Failed to load template")}finally{v(!1)}},R=async e=>{p(!0),_(""),S(!1);try{let s=new FormData;if(s.append("name",e.name),s.append("default_title",e.default_title),s.append("default_message",e.default_message),s.append("is_active",e.is_active?"true":"false"),e.background_image instanceof File)try{let t=await N(e.background_image);s.append("background_image",t)}catch(t){if(console.error("Compression failed, using original",t),e.background_image.size>10485760)throw Error("Image is too large and compression failed. Please upload a smaller image.");s.append("background_image",e.background_image)}let r="http://localhost:8000/api/v1",l=t?"".concat(r,"/invitations/templates/").concat(t,"/"):"".concat(r,"/invitations/templates/"),n=t?"PATCH":"POST",i=function(e){var t;let a="; ".concat(document.cookie).split("; ".concat(e,"="));return 2===a.length&&(null===(t=a.pop())||void 0===t?void 0:t.split(";").shift())||""}("csrftoken"),o=await fetch(l,{method:n,body:s,credentials:"include",headers:{"X-CSRFToken":i}});if(!o.ok){let e=await o.json().catch(()=>({detail:"Request failed"}));throw Error(e.detail||"Failed to ".concat(t?"update":"create"," template"))}C("success","Template ".concat(t?"updated":"created"," successfully!")),S(!0),setTimeout(()=>{a.push("/admin/invitations"),a.refresh()},1e3)}catch(t){console.error("Submission error:",t);let e=t.message||"Something went wrong";_(e),C("error",e)}finally{p(!1)}},F=async()=>{if(t&&confirm("Are you sure you want to delete this template?")){p(!0);try{await h(t),a.push("/admin/invitations"),a.refresh()}catch(e){_(e.message||"Failed to delete"),p(!1)}}};return b?(0,s.jsx)("div",{className:"p-8 text-center text-slate-500",children:"Loading template..."}):(0,s.jsxs)("div",{className:"max-w-2xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-6",children:[(0,s.jsx)(x.default,{href:"/admin/invitations",className:"p-2 hover:bg-slate-100 rounded-full transition-colors",children:(0,s.jsx)(o.Z,{className:"w-5 h-5 text-slate-500"})}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-slate-900",children:t?"Edit Template":"New Template"})]}),(0,s.jsxs)("form",{onSubmit:Z.handleSubmit(R),className:"space-y-6 bg-white p-6 rounded-xl border border-slate-200 shadow-sm",children:[j&&(0,s.jsx)("div",{className:"p-4 bg-red-50 text-red-600 rounded-lg text-sm",children:j}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Template Name"}),(0,s.jsx)("input",{...Z.register("name"),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-blue/20 focus:border-neon-blue text-slate-900",placeholder:"e.g. Superhero Theme"}),Z.formState.errors.name&&(0,s.jsx)("p",{className:"text-xs text-red-500 mt-1",children:Z.formState.errors.name.message})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(l.Qr,{control:Z.control,name:"background_image",render:e=>{var t;let{field:{value:a,onChange:r}}=e;return(0,s.jsx)(w,{label:"Background Image",value:a,onChange:r,error:null===(t=Z.formState.errors.background_image)||void 0===t?void 0:t.message})}}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"Recommended size: 1920x1080px or similar landscape."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Default Title"}),(0,s.jsx)("input",{...Z.register("default_title"),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-blue/20 focus:border-neon-blue text-slate-900",placeholder:"You're Invited!"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-slate-700 mb-1",children:"Default Message"}),(0,s.jsx)("textarea",{...Z.register("default_message"),className:"w-full px-3 py-2 border border-slate-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-neon-blue/20 focus:border-neon-blue text-slate-900 min-h-[100px]",placeholder:"Come celebrate..."})]}),(0,s.jsx)("div",{className:"flex items-center pt-2",children:(0,s.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",...Z.register("is_active"),className:"w-4 h-4 rounded border-slate-300 text-neon-blue focus:ring-neon-blue"}),(0,s.jsx)("span",{className:"text-sm font-medium text-slate-700",children:"Active (Visible to customers)"})]})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-end gap-3 pt-4 border-t border-slate-100",children:[t&&(0,s.jsxs)("button",{type:"button",onClick:F,disabled:i,className:"flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors text-sm font-medium",children:[(0,s.jsx)(c.Z,{className:"w-4 h-4"}),"Delete"]}),(0,s.jsxs)("button",{type:"submit",disabled:i||T,className:"flex items-center gap-2 px-6 py-2 rounded-lg transition-all text-sm font-bold disabled:opacity-50 ".concat(T?"bg-green-500 text-white hover:bg-green-600":"bg-neon-blue text-white hover:bg-blue-600"),children:[i?(0,s.jsx)(d.Z,{className:"w-4 h-4 animate-spin"}):T?(0,s.jsx)(u.Z,{className:"w-4 h-4"}):(0,s.jsx)(m.Z,{className:"w-4 h-4"}),T?"Saved!":t?"Update Template":"Create Template"]})]})]})]})}var C=_},24137:function(e,t,a){a.r(t),a.d(t,{ToastProvider:function(){return f},useToast:function(){return x}});var s=a(20984),r=a(95350),l=a(83631),n=a(58518),i=a(36997),o=a(4343),c=a(31959),d=a(45747),u=a(30208);let m=(0,u.createContext)(void 0);function x(){let e=(0,u.useContext)(m);if(!e)throw Error("useToast must be used within ToastProvider");return e}function f(e){let{children:t}=e,[a,l]=(0,u.useState)([]),n=(0,u.useCallback)(function(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5e3,s=Math.random().toString(36).substring(7),r={id:s,type:e,message:t,duration:a};l(e=>[...e,r]),a>0&&setTimeout(()=>{l(e=>e.filter(e=>e.id!==s))},a)},[]),i=(0,u.useCallback)(e=>{l(t=>t.filter(t=>t.id!==e))},[]);return(0,s.jsxs)(m.Provider,{value:{showToast:n},children:[t,(0,s.jsx)("div",{className:"fixed top-4 right-4 z-[9999] flex flex-col gap-3 max-w-md",children:(0,s.jsx)(r.M,{children:a.map(e=>(0,s.jsx)(p,{toast:e,onClose:()=>i(e.id)},e.id))})})]})}function p(e){let{toast:t,onClose:a}=e,r={success:(0,s.jsx)(n.Z,{className:"w-5 h-5"}),error:(0,s.jsx)(i.Z,{className:"w-5 h-5"}),warning:(0,s.jsx)(o.Z,{className:"w-5 h-5"}),info:(0,s.jsx)(c.Z,{className:"w-5 h-5"})};return(0,s.jsxs)(l.E.div,{initial:{opacity:0,y:-20,scale:.95},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,x:100,scale:.95},className:"".concat({success:"bg-green-500/10 border-green-500/30 text-green-400",error:"bg-red-500/10 border-red-500/30 text-red-400",warning:"bg-yellow-500/10 border-yellow-500/30 text-yellow-400",info:"bg-blue-500/10 border-blue-500/30 text-blue-400"}[t.type]," backdrop-blur-md border-2 rounded-xl p-4 shadow-2xl flex items-start gap-3 min-w-[300px]"),children:[(0,s.jsx)("div",{className:"flex-shrink-0 mt-0.5",children:r[t.type]}),(0,s.jsx)("p",{className:"flex-1 text-sm font-medium text-white",children:t.message}),(0,s.jsx)("button",{onClick:a,className:"flex-shrink-0 text-white/50 hover:text-white transition-colors",children:(0,s.jsx)(d.Z,{className:"w-4 h-4"})})]})}},21066:function(e,t,a){a.d(t,{j:function(){return s}});let s=e=>{if(!e)return"";if(e.startsWith("http://")||e.startsWith("https://"))return e;if(e.startsWith("uploads/")||e.startsWith("media/")||e.startsWith("logos/")){let t=e.startsWith("/")?e.substring(1):e;return"".concat("https://ninjapark.blob.core.windows.net/media","/").concat(t)}let t="http://localhost:8000/api/v1".replace("/api/v1","");return e.startsWith("/")?"".concat(t).concat(e):"".concat(t,"/").concat(e)}}}]);